services:
  db:
    image: mysql:8.0
    container_name: breeza-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpass123
      MYSQL_DATABASE: breeza_db
      MYSQL_USER: breeza_user
      MYSQL_PASSWORD: breeza_pass_2025
    # Para Azure Container Instances, usar Azure File Share en lugar de volumes locales
    # Nota: Necesitarás crear un Azure File Share y montarlo
    # volumes:
    #   - mysql-data:/var/lib/mysql
    command: --default-authentication-plugin=mysql_native_password
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-prootpass123"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s

  app:
    image: germanguerrero/breeza-app:latest
    container_name: breeza-app
    restart: unless-stopped
    depends_on:
      db:
        condition: service_healthy
    environment:
      - WEATHER_API_KEY=b687e67032891f957e3eb4f4ee4d9753
      - CALENDAR_ID=c556ba951c27378e3eb4eb86c6b7f13ac7940f61688c2224831795fb4d4f9b9a@group.calendar.google.com
      - TIMEZONE=America/Argentina/Buenos_Aires
      - LAT=-34.6037
      - LON=-58.3816
      # Variable de conexión a la base de datos para Azure Container Instances
      - DB_HOST=db
      - DB_PORT=3306
      - DB_NAME=breeza_db
      - DB_USER=breeza_user
      - DB_PASSWORD=breeza_pass_2025
    # Para Azure Container Instances, los archivos deben estar en Azure File Share
    # Necesitarás subir credentials.json y static/ a un Azure File Share
    # volumes:
    #   - azure-file-share-credentials:/app/credentials.json
    #   - azure-file-share-static:/app/static
    ports:
      - "5000:5000"

# Nota: Para usar volumes en Azure Container Instances, necesitas:
# 1. Crear un Azure Storage Account
# 2. Crear un Azure File Share
# 3. Subir los archivos necesarios (credentials.json, static/, mysql-data/)
# 4. Montar el File Share usando la configuración de Azure Container Instances
# 
# Alternativamente, puedes:
# - Incluir credentials.json en la imagen Docker (menos seguro)
# - Usar Azure Key Vault para secretos
# - Usar variables de entorno para configuración sensible

